# テスト仕様書 (Test Specifications)

## 1. テスト戦略

*   **単体テスト (Unit Test)**:
    *   ユーティリティ関数（JWT生成、日付処理など）
    *   UIコンポーネントの表示確認（React Testing Library）
*   **結合テスト (Integration Test)**:
    *   APIエンドポイントの動作確認（Supertest）
    *   DB操作の整合性確認
*   **E2E/シナリオテスト**:
    *   ユーザー操作フローの検証（実際のブラウザまたはシナリオスクリプト）

## 2. テスト環境

*   **Frontend**: React Testing Library + Jest
*   **Backend**: Jest + Supertest
*   **Database**: MySQL (Test Database / Transaction Rollback)

## 3. テスト項目一覧

### A. 認証・権限 (Authentication & Authorization)

| ID | テスト項目 | 前提条件 | 確認内容 | 期待値 |
| :--- | :--- | :--- | :--- | :--- |
| A-01 | ゲストアクセス制限 | 未ログイン | `/dashboard` へ直接アクセス | `/login` へリダイレクト、またはアクセス拒否されること |
| A-02 | ログイン成功 | 未ログイン | 正しいEmail/Passでログイン | ダッシュボードへ遷移し、トークンが保存されること |
| A-03 | ログイン失敗 | 未ログイン | 誤ったEmailまたはPassでログイン | エラーメッセージが表示され、ログインできないこと |
| A-04 | ゲストモード閲覧 | 未ログイン | `/` (Home) へアクセス | ゲスト用トップページが表示され、編集ボタン等は表示されないこと |
| A-05 | 管理者権限確認 | 教師/管理者垢でログイン | `/qr-generator` へアクセス | QRコード生成画面が表示され、生成が可能であること |

### B. 出席管理 (Attendance)

| ID | テスト項目 | 前提条件 | 確認内容 | 期待値 |
| :--- | :--- | :--- | :--- | :--- |
| B-01 | QRスキャン成功 | 学生垢でログイン | 有効なQRコードを読み取る | 「出席完了」トーストが表示され、DBにレコードが作成されること |
| B-02 | QR期限切れ | 学生垢でログイン | 期限切れQRを読み取る | エラーメッセージが表示され、出席扱いにならないこと |
| B-03 | 二重スキャン防止 | 学生垢でログイン | 同一授業のQRを2回読む | 「既に登録済みです」等のメッセージが表示され、重複登録されないこと |
| B-04 | 出席履歴確認 | 学生垢でログイン | ダッシュボードの履歴を確認 | 自分の出席記録のみが表示されること |

### C. イベント管理 (Event Management) - Phase 2

| ID | テスト項目 | 前提条件 | 確認内容 | 期待値 |
| :--- | :--- | :--- | :--- | :--- |
| C-01 | イベント作成 | 教師垢でログイン | 必須項目を入力し作成 | カレンダーにイベントが表示され、DBの `events` テーブルに保存されること |
| C-02 | 公開範囲設定 | 教師垢でログイン | `is_public=false` で作成 | ゲストまたは対象外ユーザーのカレンダーには表示されないこと |
| C-03 | 参加ステータス変更 | 招待ユーザー | イベント詳細から「参加」を選択 | DBの `event_participants` のステータスが `accepted` になること |

### D. チャット機能 (Chat) - Phase 2

| ID | テスト項目 | 前提条件 | 確認内容 | 期待値 |
| :--- | :--- | :--- | :--- | :--- |
| D-01 | メッセージ送信 | ログイン済み | テキストを入力し送信 | 画面が即時更新され、相手側にもリアルタイムで表示されること |
| D-02 | チャンネル権限 | 一般ユーザー | Privateチャンネルへアクセス | 招待されていない場合、閲覧・投稿ができないこと |

### E. 欠席申請 (Absence Request)

| ID | テスト項目 | 前提条件 | 確認内容 | 期待値 |
| :--- | :--- | :--- | :--- | :--- |
| E-01 | 申請提出 | 学生垢でログイン | 理由を記入し送信 | ステータス `pending` でDBに保存され、教師側に通知/表示されること |
| E-02 | 申請承認 | 教師垢でログイン | 申請詳細から「承認」 | ステータスが `approved` に変わり、学生側に反映されること |

### F. マルチテナント・組織 (Multi-tenancy & Organization) - New

| ID | テスト項目 | 前提条件 | 確認内容 | 期待値 |
| :--- | :--- | :--- | :--- | :--- |
| F-01 | 組織作成（管理者登録） | 未ログイン | 新規登録で組織名を入力 | 新しい組織が作成され、ユーザーがそのOwnerとして登録されること |
| F-02 | 組織参加（生徒登録） | 未ログイン | 有効な参加コードを入力 | 指定された組織に所属するStudentとして登録されること |
| F-03 | 組織参加失敗 | 未ログイン | 無効な参加コードを入力 | エラーメッセージが表示され、登録できないこと |
| F-04 | データ分離 | 組織Aのユーザー | 組織Bのデータを要求 | アクセス権限エラーまたはデータが空で返されること |

### G. 招待システム (Invitation) - New

| ID | テスト項目 | 前提条件 | 確認内容 | 期待値 |
| :--- | :--- | :--- | :--- | :--- |
| G-01 | 招待メール送信 | 管理者垢でログイン | メールアドレスとロールを指定 | 招待トークンが生成され、DBに保存されること |
| G-02 | 招待受諾 | 未ログイン | 招待リンクにアクセス | ユーザー登録画面が表示され、登録後に正しい組織・ロールが付与されること |
| G-03 | 招待キャンセル | 管理者垢でログイン | 保留中の招待をキャンセル | 招待が無効化され、そのリンクからは登録できなくなること |

## 4. 自動化テスト実装状況

### Backend (Jest + Supertest)
*   [ ] Auth API (Login, Register)
*   [ ] Invitation API
*   [ ] Organization Context

### Frontend (React Testing Library)
*   [ ] Login Component
*   [ ] Dashboard Component
